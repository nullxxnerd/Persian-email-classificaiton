import os
import pandas as pd
import numpy as np
from pathlib import Path
import re
import uuid

# Define constants for dataset generation
NUM_SAMPLES_PER_CLASS = {
    'customer_support': 500,  # پشتیبانی / شکایت مشتری
    'sales_inquiry': 500,     # درخواست فروش / استعلام قیمت
    'partnership': 500,       # همکاری / پیشنهاد شراکت
    'spam': 500               # هرزنامه / تبلیغات
}

# Expanded templates for each class (Body)
TEMPLATES = {
    'customer_support': [
        "با سلام و احترام، من {مشکلی} با {محصول} خریداری شده دارم. {توضیحات_مشکل}. لطفا راهنمایی بفرمایید.",
        "سلام، {محصول} شما {مشکل} دارد. {درخواست}. منتظر پاسخ شما هستم.",
        "با عرض سلام، {مشکل} در عملکرد {محصول} مشاهده کردم. {توضیحات}. خواهشمندم پیگیری لازم را انجام دهید.",
        "پشتیبانی گرامی، {محصول} به درستی کار نمی‌کند. {توضیحات_مشکل}. چه کاری باید انجام دهم؟",
        "سلام وقت شما بخیر، من از مشتریان شما هستم و متاسفانه {شکایت} دارم. {توضیحات}. لطفا رسیدگی کنید.",
        "احتراما به استحضار می‌رساند، {محصول} که اخیرا تهیه کرده‌ام، {مشکل} دارد. {توضیحات_مشکل}. آیا شامل گارانتی می‌شود؟",
        "{محصول} جدید من {مشکل} دارد. {درخواست}",
        "با عرض پوزش، اخیراً {محصول} خریداری کرده‌ام ولی {مشکل} دارد. {توضیحات_مشکل}.",
        "لطفاً به این موضوع رسیدگی کنید: {محصول} من {مشکل} دارد.",
        "سلام، متاسفانه {محصول} که خریدم {مشکل} داره و {توضیحات_مشکل}. لطفا کمک کنید.",
        "با سلام، {محصول} من بعد از چند روز استفاده {مشکل} پیدا کرده. {درخواست}.",
        "سلام تیم پشتیبانی، من با {محصول} به مشکل برخوردم. {توضیحات_مشکل}. راه حل چیه؟",
        "با احترام، من از {محصول} استفاده می‌کنم ولی {مشکل} داره. {توضیحات}. لطفا بررسی کنید.",
        "سلام، یه مشکلی با {محصول} دارم، {توضیحات_مشکل}. می‌تونید راهنمایی کنید؟"
    ],
    'sales_inquiry': [
        "با سلام، لطفا قیمت {محصول} را اعلام بفرمایید؟ {سوال_اضافی}",
        "سلام، می‌خواستم اطلاعات بیشتری در مورد {محصول} و شرایط فروش آن کسب کنم. {سوال}",
        "درود بر شما، برای خرید عمده {محصول}، شرایط {موضوع} چگونه است؟ آیا تخفیف همکاری در نظر گرفته می‌شود؟",
        "سلام، آیا {محصول} در حال حاضر موجود است؟ {سوال_اضافی} لطفا راهنمایی کنید.",
        "با سلام و احترام، قصد خرید {محصول} را دارم. {سوال}. لطفا کاتالوگ محصول را ارسال نمایید.",
        "قیمت {محصول} چقدر است؟ {سوال}",
        "می‌خواهم در مورد {محصول} بیشتر بدانم. {سوال_اضافی}",
        "سلام، می‌خواستم در مورد {محصول} سوال کنم. {سوال}.",
        "آیا {محصول} موجود است؟ {سوال_اضافی}",
        "لطفاً قیمت و شرایط فروش {محصول} را ارسال کنید.",
        "با سلام، می‌تونید اطلاعات {محصول} رو برام بفرستید؟ {سوال_اضافی}",
        "سلام، درباره {محصول} سوال داشتم، {سوال}. لطفا راهنمایی کنید.",
        "درود، لطفا شرایط خرید {محصول} رو بگید. {موضوع}.",
        "سلام، موجودی {محصول} چطوره؟ {سوال_اضافی}"
    ],
    'partnership': [
        "با سلام، ما شرکت {نام_شرکت} فعال در زمینه {صنعت} هستیم و مایل به همکاری استراتژیک با شما در حوزه {زمینه} هستیم. {توضیحات}. منتظر تماس شما هستیم.",
        "سلام وقت بخیر، پیشنهاد همکاری در خصوص پروژه {نام_پروژه} را خدمتتان ارائه می‌دهیم. {توضیحات_پیشنهاد}. لطفا جهت مذاکره اعلام آمادگی فرمایید.",
        "با احترام، شرکت {نام_شرکت} آماده عقد قرارداد همکاری مشترک در زمینه {زمینه} می‌باشد. {توضیحات}. رزومه شرکت به پیوست ارسال می‌گردد.",
        "درود، بدینوسیله جهت همکاری تجاری در زمینه {زمینه} اعلام آمادگی می‌کنیم. {جزئیات}. آیا امکان برگزاری جلسه وجود دارد؟",
        "با سلام، مایلیم پیشنهاد شراکت در {پروژه} را با شما مطرح کنیم. {توضیحات}. لطفا در صورت تمایل اطلاع دهید.",
        "شرکت {نام_شرکت} به دنبال همکاری در زمینه {زمینه} است. {توضیحات_پیشنهاد}.",
        "پیشنهاد همکاری در پروژه {نام_پروژه}. {جزئیات}",
        "شرکت {نام_شرکت} علاقه‌مند به همکاری در زمینه {زمینه} است.",
        "درخواست جلسه برای بحث در مورد همکاری‌های آینده.",
        "با سلام، ما از {نام_شرکت} هستیم و می‌خوایم در {زمینه} باهاتون همکاری کنیم. {توضیحات}.",
        "سلام، یه پیشنهاد همکاری برای {نام_پروژه} داریم. {جزئیات}. می‌تونیم صحبت کنیم؟",
        "با احترام، شرکت {نام_شرکت} پیشنهاد همکاری در {پروژه} داره. {توضیحات_پیشنهاد}.",
        "درود بر شما، برای همکاری در {زمینه} آماده‌ایم. {جزئیات}.",
        "سلام، می‌خواستیم در مورد شراکت تو {پروژه} باهاتون صحبت کنیم. {توضیحات}."
    ],
    'spam': [
        "تبریک! شما برنده {جایزه_بزرگ} شدید! برای دریافت جایزه خود {دستورالعمل_فوری}",
        "فروش فوق‌العاده! {محصول_جذاب} با {تخفیف_باورنکردنی} تخفیف فقط تا فردا! {توضیحات_تبلیغاتی} {لینک_خرید}",
        "راز ثروتمند شدن فاش شد! با روش {روش_سریع} می‌توانید {مبلغ_زیاد} درآمد کسب کنید! {دستورالعمل_فوری}",
        "فقط امروز! {محصول_جذاب} با قیمت استثنایی {قیمت_کم} تومان! {توضیحات_تبلیغاتی} عجله کنید! {لینک_خرید}",
        "برای دانلود {نرم‌افزار_مفید} کاملا رایگان روی لینک زیر کلیک کنید! {لینک_مشکوک}",
        "درآمد میلیونی در خانه! بدون نیاز به سرمایه! {روش_سریع}. {دستورالعمل_فوری}",
        "{محصول_جذاب} رایگان! {توضیحات_تبلیغاتی} {لینک_مشکوک}",
        "فرصت استثنایی! {محصول_جذاب} با قیمت باورنکردنی!",
        "هشدار مهم! {دستورالعمل_فوری}",
        "دانلود رایگان {نرم‌افزار_مفید} همین حالا!",
        "فقط برای شما! {محصول_جذاب} با {تخفیف_باورنکردنی}!",
        "باور نمی‌کنید! {جایزه_بزرگ} منتظر شماست! {دستورالعمل_فوری}",
        "آخرین شانس! {محصول_جذاب} با قیمت {قیمت_کم}!",
        "فوری! برای برنده شدن {جایزه_بزرگ} کلیک کنید! {لینک_مشکوک}"
    ]
}

# Expanded fill-in values for templates
FILL_IN_VALUES = {
    # Customer Support
    'مشکلی': ['اخیراً', 'یک مشکل', 'چند روزی است که یک ایراد', 'مدتی است', 'از دیروز یک نقص فنی', 'یک مورد', 'یه ایراد عجیب', 'مشکل خاصی', 'از همون اول'],
    'محصول': ['گوشی موبایل مدل X', 'لپ‌تاپ سری Y', 'تبلت اندرویدی', 'تلویزیون هوشمند 55 اینچ', 'یخچال ساید بای ساید', 'ماشین لباسشویی اتوماتیک', 
              'کولر گازی اینورتر', 'بخاری برقی', 'پنکه دیجیتال', 'جاروبرقی رباتیک', 'مایکروویو سولاردام', 'اجاق گاز فردار', 'مودم ADSL', 
              'اسپیکر بلوتوثی قابل حمل', 'هدفون بی‌سیم', 'ساعت هوشمند ورزشی', 'سرویس اینترنت', 'دوربین عکاسی', 'پلی‌استیشن 5', 'ایرپاد پرو', 
              'شارژر فندکی', 'لامپ هوشمند', 'ماشین ظرفشویی', 'پرینتر لیزری', 'دوربین مداربسته', 'هارد اکسترنال 2 ترابایت', 'فلش مموری 64 گیگ'],
    'مشکل': ['مشکل فنی دارد', 'یک ایراد نرم‌افزاری پیدا کرده', 'مشکل سخت‌افزاری دارد', 'ایراد در کارکرد دارد', 'خراب شده', 'خیلی کند شده', 
              'مرتبا قطع می‌شود', 'نویز دارد', 'بیش از حد داغ می‌شود', 'شارژ نگه نمی‌دارد', 'صفحه نمایش ترک خورده', 'باتری ضعیف', 
              'اتصال بلوتوث قطع می‌شود', 'نرم‌افزار crash می‌کند', 'ریستارت می‌شه', 'دکمه‌هاش کار نمی‌کنه', 'خاموش می‌شه یهو'],
    'توضیحات_مشکل': ['صفحه نمایش آن خاموش می‌شود', 'اصلا کار نمی‌کند', 'صدای غیرعادی تولید می‌کند', 'بسیار داغ می‌کند', 'عملکردش به شدت کند شده است',
                       'روشن نمی‌شود و هیچ چراغی ندارد', 'اتصالش مدام قطع و وصل می‌شود', 'یک پیام خطای عجیب نمایش می‌دهد', 'از دیروز دیگر کار نمی‌کند', 
                       'باتری آن خیلی زود تمام می‌شود', 'نمایشگرش خطوط رنگی نشون می‌ده', 'صدای فن خیلی زیاده', 'گاهی خود به خود خاموش می‌شه', 
                       'یه خطای عجیب می‌ده که نمی‌فهمم چیه', 'کلا قفل کرده و باز نمی‌شه'],
    'درخواست': ['لطفا برای رفع مشکل راهنمایی کنید', 'آیا امکان تعویض کالا وجود دارد؟', 'آیا گارانتی شامل این مورد می‌شود؟',
                 'چگونه می‌توانم این مشکل را برطرف کنم؟', 'آیا نیاز به ارسال برای تعمیر دارد؟', 'لطفا یک تکنسین اعزام کنید', 
                 'می‌تونید یه راه حل سریع بگید؟', 'لطفا زودتر بررسی کنید', 'می‌خوام تعویضش کنم'],
    'شکایت': ['از کیفیت پایین خدمات پس از فروش', 'از برخورد نامناسب کارشناس فروش', 'از تاخیر زیاد در ارسال سفارش', 'از قیمت‌های غیرمنصفانه', 
               'از کیفیت پایین محصول دریافتی', 'از عدم پاسخگویی پشتیبانی', 'از بسته‌بندی نامناسب', 'از اطلاعات نادرست سایت'],
    'توضیحات': ['لطفا در اسرع وقت به این موضوع رسیدگی کنید', 'این مشکل برای من بسیار آزاردهنده است', 'این ایراد باعث اختلال در کار من شده است', 
                 'انتظار خدمات بهتری از شرکت شما داشتم', 'امیدوارم هرچه زودتر این مسئله حل شود', 'خواهشمندم نتیجه را به من اطلاع دهید', 
                 'واقعا ناامید شدم از این وضعیت', 'لطفا بگید چیکار باید بکنم'],

    # Sales Inquiry
    'سوال_اضافی': ['آیا شامل گارانتی معتبر می‌شود؟', 'امکان ارسال به شهر {شهر} وجود دارد؟', 'چه رنگ‌بندی‌هایی موجود است؟',
                    'آیا امکان خرید اقساطی وجود دارد؟', 'لطفا مشخصات فنی دقیق‌تر را ارسال کنید', 'آیا امکان تست حضوری هست؟',
                    'هزینه ارسال چقدره؟', 'تا کی موجوده؟', 'می‌تونم حضوری بیام ببینم؟'],
    'سوال': ['قیمت نهایی با احتساب مالیات و هزینه ارسال چقدر است؟', 'زمان تقریبی تحویل کالا چقدر است؟', 
              'آیا مدل جدیدتر یا مشابهی هم موجود دارید؟', 'تفاوت اصلی این مدل با مدل {مدل_دیگر} چیست؟', 'روش‌های پرداخت به چه صورت است؟', 
              'آیا نمایندگی فروش در {شهر} دارید؟', 'کیفیتش چطوره؟', 'چطور می‌تونم سفارش بدم؟', 'مدل جدید کی میاد؟'],
    'موضوع': ['شرایط پرداخت', 'نحوه تحویل کالا', 'مدت زمان گارانتی', 'خدمات پس از فروش', 'هزینه نصب و راه‌اندازی', 'تخفیف خرید تعداد بالا', 
               'نحوه سفارش', 'پشتیبانی فنی'],
    'شهر': ['تهران', 'اصفهان', 'شیراز', 'مشهد', 'تبریز', 'اهواز', 'کرج', 'قم', 'رشت', 'یزد'],
    'مدل_دیگر': ['قبلی', 'پرو', 'لایت', 'استاندارد', 'پلاس', 'الیت', 'مکس'],

    # Partnership
    'نام_شرکت': ['آریا پرداز پارس', 'نوین داده پردازش آسیا', 'پیشگامان فناوری فردا', 'توسعه‌گران کسب و کار هوشمند', 'هوشمند سازان البرز', 
                  'نوآوران اقتصاد سبز', 'گروه نرم‌افزاری سینا', 'پردازشگران هوشمند', 'فناوری نوین پارس', 'شرکت دانش‌بنیان آینده', 
                  'تجارت الکترونیک پارسیان', 'ایده‌پردازان نوین', 'راهکارهای هوشمند کوشا'],
    'صنعت': ['فناوری اطلاعات و ارتباطات', 'هوش مصنوعی و یادگیری ماشین', 'تجارت الکترونیک و فروش آنلاین', 'توسعه نرم‌افزارهای سازمانی', 
              'پردازش کلان داده‌ها', 'تولید محتوای دیجیتال', 'خدمات مالی و فین‌تک', 'اینترنت اشیا', 'بلاکچین و رمز ارز', 'واقعیت مجازی'],
    'زمینه': ['توسعه بازار مشترک', 'هوشمندسازی فرآیندها', 'فروش و بازاریابی آنلاین', 'توسعه یک نرم‌افزار جدید', 'تحلیل و پردازش داده‌های مشتریان', 
               'تامین محتوای تخصصی', 'ارائه راهکارهای پرداخت نوین', 'اتوماسیون صنعتی', 'تحقیق و توسعه مشترک', 'دیجیتال مارکتینگ'],
    'توضیحات_پیشنهاد': ['ما سابقه درخشانی در پروژه‌های مشابه داریم', 'شرایط پیشنهادی ما بسیار جذاب و رقابتی است', 
                          'با همکاری یکدیگر می‌توانیم به رشد قابل توجهی دست یابیم', 'تیم فنی ما متشکل از متخصصان برجسته و باتجربه است', 
                          'راهکارهای نوآورانه‌ای برای این حوزه داریم', 'این همکاری می‌تونه خیلی سودمند باشه', 'ما ایده‌های خلاقانه‌ای داریم'],
    'نام_پروژه': ['سیستم هوشمند مدیریت ارتباط با مشتریان (CRM)', 'پلتفرم جامع بهینه‌سازی زنجیره تامین', 'سامانه یکپارچه فروش آنلاین B2B', 
                   'اپلیکیشن موبایل خدمات شهروندی', 'پروژه ملی تحلیل داده‌های سلامت', 'سامانه آموزش آنلاین', 'پلتفرم رزرو خدمات', 
                   'سیستم تحلیل رفتار مشتریان', 'اپلیکیشن مدیریت پروژه'],
    'پروژه': ['سیستم مدیریت جامع مشتریان', 'پلتفرم آموزش مجازی سازمانی', 'فروشگاه اینترنتی چند فروشندگی', 'اپلیکیشن موبایل سفارش غذا', 
               'پروژه تحقیقاتی کلان داده', 'سامانه رزرو آنلاین', 'اپلیکیشن خدمات خانگی', 'سیستم تحلیل داده‌های فروش', 'پلتفرم مدیریت منابع انسانی'],
    'جزئیات': ['جزئیات کامل طرح پیشنهادی را می‌توانیم در یک جلسه حضوری ارائه دهیم', 'رزومه و سوابق کاری شرکت به پیوست ایمیل تقدیم می‌گردد', 
                'آماده پاسخگویی به سوالات شما هستیم', 'لطفا یه زمان برای جلسه هماهنگ کنید', 'خوشحال می‌شیم بتونیم باهاتون کار کنیم'],

    # Spam
    'جایزه_بزرگ': ['یک دستگاه آیفون 15 پرومکس', '۱ میلیارد تومان وجه نقد', 'یک سفر لوکس به جزایر مالدیو', 'یک دستگاه خودروی لاماری', 
                    'یک پکیج کامل لوازم خانگی هوشمند', 'بیت‌کوین رایگان', 'یک دستگاه مک‌بوک پرو', 'یک سفر به پاریس', 
                    'یک کارت هدیه 10 میلیون تومانی', 'یک ساعت رولکس اصل', 'یک دستگاه PS5 با بازی رایگان'],
    'دستورالعمل_فوری': ['فورا با این شماره ویژه تماس بگیرید!', 'همین حالا روی لینک زیر کلیک کنید تا جایزه را از دست ندهید!', 
                          'برای تایید هویت، اطلاعات حساب بانکی خود را در فرم زیر وارد کنید!', 'کد تایید ارسال شده به موبایل خود را اینجا وارد کنید!',
                          'با شماره 09123456789 تماس بگیرید', 'به سایت ما مراجعه کنید: [لینک]', 'فرم زیر را پر کنید', 'زود باش، وقت تموم می‌شه!'],
    'محصول_جذاب': ['گوشی سامسونگ گلکسی S24 Ultra', 'پکیج لاغری تضمینی', 'دوره آموزشی کسب درآمد دلاری', 'ساعت هوشمند اپل واچ سری 9', 
                    'فیلترشکن پرسرعت بدون قطعی', 'قرص‌های افزایش قد', 'عطر اصل فرانسوی', 'کیف چرم دست‌دوز', 'دوربین GoPro', 
                    'دوره آموزش زبان با مدرک', 'اشتراک یک‌ساله نتفلیکس'],
    'تخفیف_باورنکردنی': ['۹۰٪', '۸۰٪ واقعی', '۷۵٪ استثنایی', '۵۰٪ + ارسال رایگان', '۶۰٪ شگفت‌انگیز', '۹۵٪ فقط امروز', '۸۵٪ باورنکردنی'],
    'توضیحات_تبلیغاتی': ['فرصت تکرار نشدنی!', 'تا پایان امشب فرصت دارید!', 'تعداد بسیار محدود، اولویت با اولین تماس‌ها!', 
                           'با کیفیت اورجینال و تضمین بازگشت وجه!', 'این پیشنهاد فقط برای شماست!', 'زندگی خود را متحول کنید!', 
                           'دیگه از این بهتر نمی‌شه!', 'همه دارن می‌خرن، تو چرا نه؟'],
    'روش_سریع': ['سرمایه‌گذاری در رمز ارزهای نوظهور', 'خرید و فروش سیگنال‌های بورس', 'کار در منزل با درآمد دلاری', 
                  'دانلود اپلیکیشن جادویی ما', 'سیستم همکاری در فروش با پورسانت بالا', 'استخراج بیت‌کوین با موبایل', 
                  'آموزش فارکس در 7 روز', 'فروش آنلاین بدون سرمایه'],
    'مبلغ_زیاد': ['ماهانه بیش از ۱۰۰ میلیون تومان', 'روزانه ۵ میلیون تومان سود خالص', 'هفتگی ۲۰ میلیون تومان تضمینی', 
                    'سالانه ۱ میلیارد تومان بدون زحمت', 'درآمد دلاری باورنکردنی', 'هر ماه ۵۰ میلیون راحت', 'روزانه ۱۰ میلیون سود'],
    'قیمت_کم': ['فقط ۹,۹۰۰ تومان', 'تنها ۴۹ هزار تومان ناقابل', '۱۱۹ هزار تومان استثنایی', '۲۹,۰۰۰ تومان باورنکردنی', 
                 'رایگان برای ۱۰۰ نفر اول', 'فقط ۵,۰۰۰ تومان', '۱۵,۰۰۰ تومان ارزون'],
    'نرم‌افزار_مفید': ['آنتی‌ویروس قدرتمند ۲۰۲۴', 'بهترین ویرایشگر عکس اندروید', 'نرم‌افزار حرفه‌ای حسابداری شخصی', 
                        'مجموعه بازی‌های پرطرفدار موبایل', 'آرشیو کامل فیلم و سریال روز دنیا', 'فالگیر هوشمند', 
                        'اپلیکیشن یادگیری زبان', 'نرم‌افزار هک رشد', 'ابزار طراحی گرافیک'],
    'لینک_مشکوک': ['www.secure-login-update.com/verify', 'https://bit.ly/FreeGiftNow4U', 'telegram.me/joinchat/SecretChannelLink', 
                    't.me/EarnMoneyFastBot', 'http://getyourprize.xyz/claim', 'app-download-center.org', 'win-prize-now.com', 
                    'free-download-app.net', 'super-offer.ir'],
    'لینک_خرید': ['برای خرید کلیک کنید: [لینک]', 'سفارش دهید: [لینک]', 'اطلاعات بیشتر و خرید: [لینک]', 'همین حالا بخرید: [لینک]', 
                   'خرید فوری: [لینک]']
}

# Subject templates for each class
SUBJECT_TEMPLATES = {
    'customer_support': [
        "مشکل با {محصول}",
        "درخواست پشتیبانی برای {مشکل}",
        "شکایت از {محصول}",
        "نیاز به کمک فوری",
        "ایراد در {محصول}",
        "مشکل فوری با {محصول}",
        "درخواست بررسی {مشکل}"
    ],
    'sales_inquiry': [
        "استعلام قیمت {محصول}",
        "سوال در مورد {محصول}",
        "درخواست اطلاعات فروش",
        "موجودی {محصول}",
        "شرایط خرید {محصول}",
        "سوال درباره {موضوع}",
        "درخواست کاتالوگ {محصول}"
    ],
    'partnership': [
        "پیشنهاد همکاری از {نام_شرکت}",
        "درخواست جلسه همکاری",
        "همکاری در زمینه {زمینه}",
        "معرفی شرکت {نام_شرکت}",
        "پیشنهاد برای {پروژه}",
        "همکاری در {نام_پروژه}",
        "درخواست شراکت تجاری"
    ],
    'spam': [
        "فوری! شما برنده شدید!",
        "تخفیف ویژه!",
        "فرصت طلایی!",
        "دانلود رایگان!",
        "فقط امروز! {محصول_جذاب}",
        "جایزه بزرگ در انتظار شماست!",
        "عرضه محدود! عجله کنید!"
    ]
}

# Noise elements
SALUTATIONS = [
    "با سلام", "سلام", "درود", "با درود", "سلام و وقت بخیر", "با عرض سلام", "سلام بر شما", 
    "با احترام", "سلام وقتتون بخیر", "درود بی‌کران"
]

CLOSINGS = [
    "با تشکر", "ممنونم", "با سپاس", "تشکر", "با احترام", "مرسی", "سپاسگزارم", "با تقدیم احترام", 
    "ممنون از توجهتون", "با آرزوی موفقیت"
]

EXTRA_SENTENCES = {
    'customer_support': [
        "به هر حال، امیدوارم این مشکل به زودی حل شود.",
        "ممنون از توجه شما.",
        "لطفاً در اسرع وقت پاسخ دهید.",
        "واقعا از این وضعیت کلافه شدم.",
        "امیدوارم بتونید سریع کمک کنید.",
        "لطفا بگید چقدر طول می‌کشه.",
        "ممنون می‌شم اگه زود جواب بدید."
    ],
    'sales_inquiry': [
        "ممنون از همکاری شما.",
        "منتظر پاسخ شما هستم.",
        "در صورت امکان، لطفاً اطلاعات را به ایمیل من ارسال کنید.",
        "لطفا زودتر اطلاع بدید.",
        "مرسی که وقت گذاشتید.",
        "اگه امکانش هست تلفنی هم بتونم بپرسم؟",
        "لطفا بگید کی موجود می‌شه."
    ],
    'partnership': [
        "با تشکر از توجه شما.",
        "امیدوارم این همکاری برای هر دو طرف سودمند باشد.",
        "لطفاً در صورت تمایل، زمان مناسبی برای جلسه پیشنهاد دهید.",
        "مشتاق همکاری با شما هستیم.",
        "لطفا رزومه ما رو هم بررسی کنید.",
        "امیدوارم بتونیم باهم پروژه خوبی داشته باشیم.",
        "ممنون می‌شم اگه نظرتون رو بگید."
    ],
    'spam': [
        "عجله کنید، این پیشنهاد محدود است!",
        "فرصت را از دست ندهید!",
        "همین حالا اقدام کنید!",
        "فقط برای تعداد محدودی در دسترس!",
        "دیگه منتظر چی هستید؟",
        "زود باش، تموم می‌شه!",
        "این شانس یه بار تو عمره!"
    ]
}

TYPOS = {
    'لطفا': ['لظفا', 'لطفاً', 'لطفن'],
    'مشکل': ['مشگل', 'مشککل', 'مشکلل'],
    'سلام': ['سلاام', 'سلم', 'سلامم'],
    'محصول': ['محصصول', 'محصولل', 'محصوول'],
    'ممنون': ['مممنون', 'ممننون', 'ممنوون']
}

def introduce_typos(text):
    """Introduce random typos to the text with a small probability."""
    for word, typo_variants in TYPOS.items():
        if np.random.rand() < 0.1:  # 10% chance for each typo
            text = re.sub(r'\b' + word + r'\b', np.random.choice(typo_variants), text)
    return text

def fill_template(template):
    """Fill template with random values and return filled template and filled values."""
    placeholders = re.findall(r'\{([^}]+)\}', template)
    filled_values = {}
    filled_template = template
    for placeholder in placeholders:
        if placeholder in FILL_IN_VALUES:
            value = np.random.choice(FILL_IN_VALUES[placeholder])
            filled_values[placeholder] = value
            filled_template = re.sub(r'\{' + re.escape(placeholder) + r'\}', value, filled_template, count=1)
    return filled_template, filled_values

def generate_subject(email_class, filled_values):
    """Generate a subject line using subject templates and filled values."""
    subject_template = np.random.choice(SUBJECT_TEMPLATES[email_class])
    for placeholder, value in filled_values.items():
        subject_template = subject_template.replace(f'{{{placeholder}}}', value)
    subject_template = introduce_typos(subject_template)
    return subject_template

def generate_email_data():
    """Generate the synthetic email dataset with 'text' and 'label' columns."""
    data = []
    
    for label, num_samples in NUM_SAMPLES_PER_CLASS.items():
        templates = TEMPLATES[label]
        
        for _ in range(num_samples):
            template = np.random.choice(templates)
            email_body, filled_values = fill_template(template)
            
            # Add noise: salutation, extra sentences, closing
            salutation = np.random.choice(SALUTATIONS)
            closing = np.random.choice(CLOSINGS)
            extra_sentence = np.random.choice(EXTRA_SENTENCES[label])
            
            email_body = f"{salutation}\n{email_body}\n\n{extra_sentence}\n\n{closing}"
            email_body = introduce_typos(email_body)
            
            subject = generate_subject(label, filled_values)
            email_text = f"موضوع: {subject}\n\n{email_body}"
            
            data.append({
                'text': email_text,
                'label': label
            })
    
    np.random.shuffle(data)
    df = pd.DataFrame(data)
    return df

def save_dataset(df, output_path="persian_emails.csv"):
    """Save the dataset (only text and label columns) to a CSV file."""
    output_dir = Path(output_path).parent
    output_dir.mkdir(parents=True, exist_ok=True)
    
    if 'text' in df.columns and 'label' in df.columns:
        df_to_save = df[['text', 'label']]
    else:
        print("Error: 'text' or 'label' column not found in DataFrame.")
        return
        
    df_to_save.to_csv(output_path, index=False, encoding='utf-8')
    print(f"Dataset with {len(df_to_save)} emails saved to {output_path}")

def main():
    """Main function to generate and save the dataset."""
    print("Generating synthetic Persian email dataset...")
    df = generate_email_data()
    
    script_dir = Path(__file__).resolve().parent
    output_path = script_dir / "persian_emails.csv"
    
    save_dataset(df, output_path)
    
    print(f"Total emails generated: {len(df)}")
    print("Label distribution:")
    print(df['label'].value_counts().to_string())

if __name__ == "__main__":
    main()